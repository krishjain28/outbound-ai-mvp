# 🔧 Backend Deployment Troubleshooting Guide

## Current Issue: Backend Timeout (502 Error)

The backend at `https://outbound-ai-backend.onrender.com` is not responding, causing 502 errors.

## 🔍 Diagnostic Results

- ✅ Frontend (Vercel): Working properly
- ❌ Backend (Render): Not responding (timeout)
- ❌ Database: Cannot be reached due to backend issues

## 🚨 Immediate Actions Required

### 1. Check Render Dashboard
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Find your `outbound-ai-backend` service
3. Check the deployment status:
   - **Live**: Service should be running
   - **Build Failed**: Check build logs
   - **Deploying**: Wait for completion

### 2. Check Build Logs
If deployment failed, check the build logs for errors:
- Environment variable issues
- Dependency installation problems
- MongoDB connection errors
- Port configuration issues

### 3. Check Service Logs
View the runtime logs to see what's happening:
- Application startup errors
- MongoDB connection failures
- Port binding issues
- Environment variable problems

## 🔧 Common Fixes

### Fix 1: Environment Variables
Ensure these are set in Render dashboard:
```
NODE_ENV=production
PORT=10000
MONGODB_URI=mongodb+srv://krishjain:Krish@123@cluster0.v7ckm.mongodb.net/outbound-ai-mvp?retryWrites=true&w=majority
JWT_SECRET=<auto-generated>
FRONTEND_URL=https://outbound-ai-frontend.vercel.app
BACKEND_URL=https://outbound-ai-backend.onrender.com
```

### Fix 2: MongoDB Atlas Connection
1. Check MongoDB Atlas cluster status
2. Verify IP whitelist (should allow all IPs: `0.0.0.0/0`)
3. Confirm username/password are correct
4. Test connection string format

### Fix 3: Port Configuration
The backend should use port 10000 as configured in render.yaml:
```yaml
- key: PORT
  value: 10000
```

### Fix 4: Build Command
Ensure the build command is correct:
```yaml
buildCommand: cd backend && npm install --production
startCommand: cd backend && node server.js
```

## 🛠️ Manual Recovery Steps

### Step 1: Restart the Service
1. Go to Render dashboard
2. Find your backend service
3. Click "Manual Deploy" → "Deploy latest commit"

### Step 2: Check MongoDB Atlas
1. Go to [MongoDB Atlas](https://cloud.mongodb.com)
2. Check cluster status
3. Verify connection string
4. Test connection from MongoDB Compass or shell

### Step 3: Verify Environment Variables
1. In Render dashboard, go to Environment tab
2. Verify all required variables are set
3. Check for any syntax errors

### Step 4: Check Dependencies
Ensure all required dependencies are in `backend/package.json`:
```json
{
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.0.0",
    "winston": "^3.8.2",
    "dotenv": "^16.0.3",
    "cors": "^2.8.5",
    "helmet": "^6.0.1"
  }
}
```

## 🔍 Debugging Commands

### Test MongoDB Connection Locally
```bash
node test-mongodb-connection.js
```

### Check Cloud Deployment Status
```bash
node check-cloud-deployment.js
```

### Run Backend Diagnostic
```bash
node diagnose-backend.js
```

## 📋 Deployment Checklist

Before deploying, ensure:

- [ ] All environment variables are set in Render
- [ ] MongoDB Atlas cluster is running
- [ ] Connection string is correct
- [ ] Dependencies are properly listed in package.json
- [ ] Port configuration matches render.yaml
- [ ] Build and start commands are correct

## 🚨 Emergency Recovery

If the service is completely down:

1. **Manual Deploy**: Trigger a new deployment from Render dashboard
2. **Check Logs**: Review build and runtime logs for errors
3. **Verify Config**: Double-check all configuration settings
4. **Test Locally**: Run the backend locally to verify it works
5. **Contact Support**: If issues persist, contact Render support

## 📞 Support Resources

- **Render Documentation**: https://render.com/docs
- **MongoDB Atlas Documentation**: https://docs.atlas.mongodb.com
- **Render Status Page**: https://status.render.com

## 🔄 Next Steps

1. Check Render dashboard immediately
2. Review build and runtime logs
3. Verify environment variables
4. Test MongoDB connection
5. Restart service if needed
6. Monitor deployment status

## 📊 Expected Timeline

- **Immediate**: Check dashboard and logs (5 minutes)
- **Quick Fix**: Restart service (2-5 minutes)
- **Configuration Fix**: Update environment variables (5-10 minutes)
- **Full Recovery**: Complete troubleshooting and redeploy (15-30 minutes)

---

**Remember**: The backend must be running on Render for the entire system to work. The frontend depends on the backend API endpoints. 